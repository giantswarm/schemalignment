<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Cluster app values schema</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="normalize.css">
  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <div>
    <table id="table" class="table table-hover sortable" data-toggle="table">
      <thead class="table-light" style="position: sticky; top: 0;">
        <tr>
          <th scope="col">Property</th>
          <th scope="col" class="ctd">Providers</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>


  <script src="javascript.js"></script>
  <script>
  let splitProperty = function(s){
    let parts = [];
    
    // remove leading separator
    s = s.substring(1, s.length);

    s.split('/').forEach((item, n) => {
      parts.push('<span class="propchunk">.' + item + '</span>');
    });

    return parts.join('');
  };

  $(document).ready(function() {
    fetch('/data.json')
      .then((response) => response.json())
      .then((data) => {
        let table = $('#table');
        let headerRow = table.find('thead tr');
        data.providers.forEach(provider => {
          headerRow.append('<th scope="col" class="ctd">'+ provider +'</th>');
        });

        let tbody = table.find('tbody');
        data.property_keys.forEach(prop => {
          let row = $('<tr><th scope="row" class="prop">'+ splitProperty(prop) +'</th><td class="ctd">'+ data.properties_and_providers[prop].length +'</td></tr>');

          data.providers.forEach(provider => {
            row.append('<td class="ctd">'+ (data.properties_and_providers[prop].includes(provider) ? 'âœ…' : '') +'</td>');
          });
          tbody.append(row);
        });
      });
  });
  </script>
</body>

</html>
